# yaml-language-server: $schema=https://moonrepo.dev/schemas/tasks.json
$schema: 'https://moonrepo.dev/schemas/tasks.json'

# Global file groups, this will be inherited by all projects.
# @see: https://moonrepo.dev/docs/config/project#filegroups
fileGroups:
  js-configs:
    - '*.config.{js,cjs,mjs,ts}'
    - '*.json'
  js-sources:
    - 'src/**/*'
    - 'types/**/*'
  tests:
    - 'tests/**/*'
    - '**/__tests__/**/*'
  assets:
    - 'assets/**/*'
    - 'images/**/*'
    - 'static/**/*'
    - 'public/**/*'
    - '**/*.{scss,css}'
  nextjs:
    - 'app/**/*'
    - 'pages/**/*'
    - 'public/**/*'
    - 'src/**/*'
    - 'next-env.d.ts'
    - 'next.config.*'
  sources: []

taskOptions:
  runDepsInParallel: false

# Defines task deps that are implicitly inserted into all inherited tasks within a project.
# This is extremely useful for pre-building projects that are used extensively throughout
# the repo, or always building project dependencies.
# implicitDeps:
#   - '^:format'

# Common tasks that can be inherited by all projects.
# @see: https://moonrepo.dev/docs/config/tasks
tasks:
  docker-build:
    command: 'docker build -f $projectRoot/Dockerfile . -t $APP_NAME:$APP_VERSION'
    options:
      outputStyle: stream
      runFromWorkspaceRoot: true
      runInCI: false
      cache: false
      shell: true

  docker-run:
    command: 'docker run --network=host --rm -it --env-file .env --name $APP_NAME $APP_NAME:$APP_VERSION'
    options:
      runFromWorkspaceRoot: true
      interactive: false
      outputStyle: stream
      runInCI: false
      cache: false
      shell: true

  docker-shell:
    command: 'docker run --network=host --rm -it --env-file .env --entrypoint /bin/sh $APP_NAME:$APP_VERSION'
    options:
      runFromWorkspaceRoot: true
      interactive: false
      outputStyle: none
      runInCI: false
      cache: false
      shell: true

  docker-images:
    command: 'docker image list --filter reference=$APP_NAME:\\*'
    options:
      runFromWorkspaceRoot: true
      outputStyle: none
      runInCI: false
      cache: false
      shell: true
